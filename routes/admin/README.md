# Admin Routes Structure - Decor & More

تم إعادة هيكلة routes الإدارة لتحسين التنظيم وسهولة الصيانة.

## البنية الجديدة:

```
routes/admin/
├── index.js          # الملف الرئيسي الذي يجمع كل admin routes
├── dashboard.js      # لوحة الإدارة والإحصائيات
├── engineers.js      # إدارة المهندسين
└── README.md         # هذا الملف
```

## الملفات:

### 1. `index.js`
- الملف الرئيسي الذي يستورد ويجمع كل admin routes
- يتم استيراده في `app.js`

### 2. `dashboard.js`
- `GET /AdminDashboard` - عرض لوحة الإدارة الرئيسية
- `GET /admin/client-count` - جلب عدد العملاء الإجمالي
- عرض الإحصائيات والتقارير

### 3. `engineers.js`
- `DELETE /AdminDashboard/engineers/:id` - حذف مهندس
- `POST /approve-engineer` - الموافقة على مهندس
- `GET /pending-engineers` - جلب المهندسين المعلقين
- `POST /reject-engineer` - رفض مهندس

## المميزات:

### ✅ **تنظيم أفضل:**
- فصل منطق لوحة الإدارة عن إدارة المهندسين
- كل ملف متخصص في وظيفة محددة
- كود أنظف وأكثر تركيز

### ✅ **أمان محسن:**
- التحقق من صلاحية Admin في كل route
- حماية من الوصول غير المصرح به
- validation للعمليات الحساسة

### ✅ **إدارة شاملة:**
- إحصائيات مفصلة للنظام
- إدارة كاملة للمهندسين
- تقارير الإيرادات والحجوزات

## API Endpoints:

### **لوحة الإدارة:**
- `GET /AdminDashboard` - لوحة الإدارة الرئيسية
- `GET /admin/client-count` - عدد العملاء

### **إدارة المهندسين:**
- `DELETE /AdminDashboard/engineers/:id` - حذف مهندس
- `POST /approve-engineer` - الموافقة على مهندس
- `GET /pending-engineers` - المهندسين المعلقين
- `POST /reject-engineer` - رفض مهندس

## الوظائف الرئيسية:

### **لوحة الإدارة:**
- عرض إجمالي المهندسين
- عرض المهندسين المعلقين
- عرض إجمالي العملاء
- عرض متوسط التقييمات
- عرض إجمالي الإيرادات
- جدول تفصيلي للحجوزات والعمولات

### **إدارة المهندسين:**
- الموافقة على المهندسين الجدد
- إرسال email تفعيل مع verification code
- رفض المهندسين وحذفهم
- حذف مهندس مع كل بياناته (مشاريع، باقات)

## مثال للاستخدام:

### قبل (في ملف واحد):
```javascript
// adminRoutes.js (179 سطر)
router.get("/AdminDashboard", async (req, res) => {
  // منطق لوحة الإدارة
});

router.post("/approve-engineer", async (req, res) => {
  // منطق الموافقة على المهندس
});
```

### بعد (منظم في ملفات):
```javascript
// dashboard.js
router.get("/AdminDashboard", async (req, res) => {
  // منطق لوحة الإدارة فقط
});

// engineers.js
router.post("/approve-engineer", async (req, res) => {
  // منطق إدارة المهندسين فقط
});
```

## الإحصائيات المعروضة:

### **إحصائيات عامة:**
- إجمالي المهندسين
- المهندسين المعلقين للموافقة
- إجمالي العملاء
- متوسط التقييمات
- إجمالي الإيرادات (العمولات)

### **تفاصيل الحجوزات:**
- اسم المهندس
- نوع المناسبة
- اسم الباقة
- السعر الإجمالي
- المقدم المدفوع
- العمولة
- المبلغ المتبقي
- تاريخ الحجز

## الأمان والصلاحيات:

### **التحقق من Admin:**
```javascript
if (!req.session.user || req.session.user.role !== "Admin") {
  return res.status(403).send("Access denied. Admins only.");
}
```

### **العمليات الحساسة:**
- حذف المهندس يحذف كل بياناته
- الموافقة على المهندس ترسل email تفعيل
- رفض المهندس يحذفه من النظام

## الفوائد:

1. **كود أنظف** - كل ملف متخصص في وظيفة واحدة
2. **صيانة أسهل** - تعديل منطق لوحة الإدارة أو المهندسين منفصل
3. **أمان أفضل** - التحقق من الصلاحيات في كل route
4. **تطوير أسرع** - فرق متعددة تعمل على أجزاء مختلفة
5. **مراقبة أفضل** - إحصائيات مفصلة ومنظمة

## ملاحظات:

- ✅ تم الحفاظ على نفس الوظائف
- ✅ نفس واجهة لوحة الإدارة
- ✅ تحسين الأمان والتحقق
- ✅ إحصائيات دقيقة ومفصلة

## الخطوات التالية:

1. إضافة إدارة العملاء
2. تحسين التقارير والإحصائيات
3. إضافة audit logs للعمليات
4. تحسين notification system للإدارة

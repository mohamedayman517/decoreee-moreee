# Profile Routes Structure

هذا المجلد يحتوي على جميع routes المتعلقة بالملفات الشخصية مقسمة إلى ملفات منفصلة لسهولة الصيانة والتطوير.

## البنية:

```
routes/profile/
├── index.js          # الملف الرئيسي الذي يجمع كل profile routes
├── engineer.js       # ملفات المهندسين وعرضهم
├── client.js         # ملفات العملاء وتسجيلهم
├── rating.js         # تقييم المهندسين
├── update.js         # تحديث الملفات الشخصية
├── helpers.js        # الدوال المساعدة المشتركة
└── README.md         # هذا الملف
```

## الملفات:

### 1. `index.js`
- الملف الرئيسي الذي يستورد ويجمع كل profile routes
- يتم استيراده في `app.js`
- يصدر دالة `updateBadges` من engineer routes

### 2. `engineer.js`
- `GET /profile/:id` - عرض ملف المهندس الشخصي
- `GET /eng` - عرض قائمة المهندسين مع الفلترة
- `updateBadges()` - تحديث شارات المهندسين
- التحقق من تأكيد البريد الإلكتروني للمهندسين

### 3. `client.js`
- `POST /payment/login` - تسجيل دخول العميل للدفع
- `POST /payment/register` - تسجيل عميل جديد للدفع
- التحقق من عدم تكرار البريد الإلكتروني
- رفع صور الملف الشخصي

### 4. `rating.js`
- `POST /rate` - تقييم المهندسين
- التحقق من صحة بيانات التقييم
- حساب متوسط التقييمات
- تحديث أو إضافة تقييمات جديدة

### 5. `update.js`
- `POST /updateProfile` - تحديث الملف الشخصي
- رفع صور جديدة وتحويلها لـ base64
- التحقق من تأكيد البريد الإلكتروني
- تحديث بيانات الجلسة

### 6. `helpers.js`
- `upload` - إعدادات Multer لرفع الملفات
- `ratingSchema` - schema للتحقق من صحة التقييمات
- `convertToBase64()` - تحويل الملفات لـ base64
- `cleanupTempFile()` - حذف الملفات المؤقتة
- `checkUserVerification()` - التحقق من تأكيد البريد الإلكتروني

## المميزات:

✅ **تنظيم أفضل** - كل وظيفة في ملف منفصل
✅ **فصل المسؤوليات** - مهندسين، عملاء، تقييمات، تحديثات
✅ **دوال مساعدة مشتركة** - تجنب تكرار الكود
✅ **التحقق من الصحة** - validation شامل للبيانات
✅ **إدارة الملفات** - رفع وتحويل الصور بأمان

## تدفق العمل:

1. **عرض المهندسين** (`engineer.js`)
   - عرض قائمة المهندسين مع الفلترة
   - عرض ملف المهندس الشخصي
   - تحديث الشارات تلقائياً

2. **تسجيل العملاء** (`client.js`)
   - تسجيل دخول العملاء للدفع
   - تسجيل عملاء جدد
   - رفع صور الملف الشخصي

3. **التقييمات** (`rating.js`)
   - إضافة تقييمات للمهندسين
   - تحديث التقييمات الموجودة
   - حساب متوسط التقييمات

4. **التحديثات** (`update.js`)
   - تحديث بيانات الملف الشخصي
   - رفع صور جديدة
   - تحديث بيانات الجلسة

## نظام الشارات:

- **Premium Designer** - 15+ حجز، تقييم 4+، 10+ مشاريع
- **Top Rated** - تقييم 4.5+
- **Most Booked** - 10+ حجوزات
- **New Talent** - مهندس جديد بدون حجوزات
- **Project Master** - 10+ مشاريع

## الأمان:

- التحقق من تأكيد البريد الإلكتروني للمهندسين
- تشفير كلمات المرور
- التحقق من صحة البيانات المدخلة
- حماية من تكرار البريد الإلكتروني
- تنظيف الملفات المؤقتة

## ملاحظات:

- تم الحفاظ على نفس الوظائف بالضبط من الملف الأصلي `profileRoutes.js`
- لم يتم تغيير أي منطق أعمال
- تم إنشاء backup من الملف الأصلي: `profileRoutes.js.backup`
- جميع الـ routes تعمل بنفس الطريقة السابقة
